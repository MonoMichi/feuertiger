Prepare:
  extends:
    - .job-base
    - .docker-in-docker
  only:
    changes:
      - .dev-env.Dockerfile
  stage: Prepare
  script:
    - (docker pull $DEV_ENVIRONMENT_IMAGE_TAG && docker build --cache-from $DEV_ENVIRONMENT_IMAGE_TAG -t $DEV_ENVIRONMENT_IMAGE_TAG .) || docker build -t $DEV_ENVIRONMENT_IMAGE_TAG .
    - docker push $DEV_ENVIRONMENT_IMAGE_TAG

