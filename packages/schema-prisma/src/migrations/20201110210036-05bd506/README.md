# Migration `20201110210036-05bd506`

This migration has been generated by michael.thanei at 11/10/2020, 9:00:36 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Grade" AS ENUM ('FA', 'FM', 'OFM', 'HFM', 'LM', 'OLM', 'HLM', 'BM', 'OBM', 'HBM')

CREATE TYPE "public"."Sex" AS ENUM ('MALE', 'FEMALE', 'DIVERSE')

CREATE TABLE "Exercise" (
    "id" TEXT NOT NULL,
    "topic" TEXT NOT NULL,
    "timeslotId" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Address" (
    "id" TEXT NOT NULL,
    "street" TEXT NOT NULL,
    "streetNumber" TEXT NOT NULL,
    "postalCode" TEXT NOT NULL,
    "city" TEXT NOT NULL,
    "country" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Membership" (
    "id" TEXT NOT NULL,
    "active" BOOLEAN NOT NULL,
    "entryDate" TIMESTAMP(3) NOT NULL,
    "personId" TEXT NOT NULL,
    "departureDate" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "Promotion" (
    "id" TEXT NOT NULL,
    "dateOfPromotion" TIMESTAMP(3) NOT NULL,
    "personId" TEXT NOT NULL,
    "grade" "Grade" NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Person" (
    "id" TEXT NOT NULL,
    "firstname" TEXT NOT NULL,
    "lastname" TEXT NOT NULL,
    "sex" "Sex" NOT NULL,
    "phone" TEXT NOT NULL,
    "birthName" TEXT NOT NULL,
    "placeOfBirth" TEXT NOT NULL,
    "avatar" TEXT NOT NULL,
    "dateOfBirth" TIMESTAMP(3) NOT NULL,
    "membershipNumber" TEXT NOT NULL,
    "addressId" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Timeslot" (
    "id" TEXT NOT NULL,
    "start" TIMESTAMP(3) NOT NULL,
    "end" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "_Exercise_Leader" (
    "A" TEXT NOT NULL,
    "B" TEXT NOT NULL
)

CREATE TABLE "_Exercise_Participant" (
    "A" TEXT NOT NULL,
    "B" TEXT NOT NULL
)

CREATE UNIQUE INDEX "_Exercise_Leader_AB_unique" ON "_Exercise_Leader"("A", "B")

CREATE INDEX "_Exercise_Leader_B_index" ON "_Exercise_Leader"("B")

CREATE UNIQUE INDEX "_Exercise_Participant_AB_unique" ON "_Exercise_Participant"("A", "B")

CREATE INDEX "_Exercise_Participant_B_index" ON "_Exercise_Participant"("B")

ALTER TABLE "Exercise" ADD FOREIGN KEY("timeslotId")REFERENCES "Timeslot"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Membership" ADD FOREIGN KEY("personId")REFERENCES "Person"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Promotion" ADD FOREIGN KEY("personId")REFERENCES "Person"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Person" ADD FOREIGN KEY("addressId")REFERENCES "Address"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_Exercise_Leader" ADD FOREIGN KEY("A")REFERENCES "Exercise"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_Exercise_Leader" ADD FOREIGN KEY("B")REFERENCES "Person"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_Exercise_Participant" ADD FOREIGN KEY("A")REFERENCES "Exercise"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_Exercise_Participant" ADD FOREIGN KEY("B")REFERENCES "Person"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201110210036-05bd506
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,92 @@
+datasource postgresql {
+  url = "***"
+  provider = "postgresql"
+}
+
+generator client {
+  provider        = "prisma-client-js"
+  previewFeatures = ["transactionApi"]
+  binaryTargets   = ["native", "linux-musl"]
+  output          = "../dist"
+}
+
+model Exercise {
+  id           String   @id
+  topic        String
+  timeslot     Timeslot @relation(fields: [timeslotId], references: [id])
+  timeslotId   String
+  leaders      Person[] @relation("Exercise_Leader", references: [id])
+  participants Person[] @relation("Exercise_Participant", references: [id])
+}
+
+model Address {
+  id           String   @id
+  street       String
+  streetNumber String
+  postalCode   String
+  city         String
+  country      String
+  Person       Person[]
+}
+
+model Membership {
+  id            String    @id
+  active        Boolean
+  entryDate     DateTime
+  personId      String
+  person        Person    @relation("Person_Membership", fields: [personId])
+  departureDate DateTime?
+}
+
+enum Grade {
+  FA
+  FM
+  OFM
+  HFM
+  LM
+  OLM
+  HLM
+  BM
+  OBM
+  HBM
+}
+
+enum Sex {
+  MALE
+  FEMALE
+  DIVERSE
+}
+
+model Promotion {
+  id              String   @id
+  dateOfPromotion DateTime
+  personId        String
+  person          Person   @relation("Person_Promotion", fields: [personId])
+  grade           Grade
+}
+
+model Person {
+  id                    String       @id
+  firstname             String
+  lastname              String
+  sex                   Sex
+  phone                 String
+  birthName             String
+  placeOfBirth          String
+  avatar                String
+  dateOfBirth           DateTime
+  membershipNumber      String
+  addressId             String
+  address               Address      @relation(fields: [addressId], references: [id])
+  memberships           Membership[] @relation("Person_Membership")
+  promotions            Promotion[]  @relation("Person_Promotion")
+  exercisesParticipated Exercise[]   @relation("Exercise_Participant", references: [id])
+  exercisesLeaded       Exercise[]   @relation("Exercise_Leader", references: [id])
+}
+
+model Timeslot {
+  id       String     @id
+  start    DateTime
+  end      DateTime
+  exercise Exercise[]
+}
```
